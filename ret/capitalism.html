<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>a website: capitalism</title>
<link href="../default.css" rel="stylesheet" type="text/css">
<style>
body
{
	background-color: #000000;
	generic-family: serif;
	font-family: "Garamond", Garamond, serif;
	font-weight: lighter;
	text-align: justify;
}
hr
{
	background-color: #00ff00;
	height:1px;
	border-width:0;
}
h1
{
	color: #00ff00;
}
.button
{
	background-color: #000000;
	display: inline-block;
	font-family: Consolas,"courier new";
}
.button-enabled{color:#ffffff;cursor:pointer;animation-name:button-e;animation-duration:0.2s;}
.button-disabled{color:#aaaaaa;cursor:default;animation-name:button-d;animation-duration:0.2s;}
@keyframes button-e {from {color:#aaaaaa} to {color:#ffffff}}
@keyframes button-d {from {color:#ffffff} to {color:#aaaaaa}}
.title
{
	color:#aaaaaa;
	display:inline;
}
.important-text
{
	animation-name: notify;
	animation-duration: 1s;
	animation-iteration-count: infinite;
}
@keyframes notify {from {color:#ffff00} to {color:#00ff00}}
.svgtext
{
	font-family:initial;
	text-align:center;
	text-anchor:middle;
	text-shadow:2px 2px black;
}
.price-cantafford {color:#cd2512;font-size:16px;font-family:initial;display:inline;animation-name:cantafford;animation-duration:0.2s;}
.price-canafford {color:#25cd12;font-size:16px;font-family:initial;display:inline;animation-name:canafford;animation-duration:0.2s;}
.noselect {user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;-moz-user-select:none;-ms-user-select:none;}
@keyframes canafford {from {color: #cd2512;} to {color: #25cd12;}}
@keyframes cantafford {from {color: #25cd12;} to {color: #cd2512;}}
.building
{
	border:1px solid #999999;
	padding:10px;
	margin:0px 16px 16px 0px;
	max-width:400px;
}
.upgrades
{
	border:1px solid gold;
	padding:10px;
	margin:0px 16px 16px 0px;
}
details > summary {
	padding: 4px;
	width: 200px;
	background-color: #333333;
	border: none;
	box-shadow: 1px 1px 2px #888888;
	cursor: pointer;
	font-family: initial;
	color: #a1ea1e;
	font-size: 14px;
}
details > p {
	background-color: #333333;
	padding: 4px;
	margin: 0;
	box-shadow: 1px 1px 2px #888888;
	color: #eeeeee;
	font-size: 14px;
}
</style>
</head>
<body>
<center><h1>Capitalsim</h1></center>
<hr>
<div id="settings" style="position:absolute;right:16px;border:4px solid #ffffff;color:#ffffff;width:440px;font-family:initial;padding:4px;">
	<div style="text-align:center">settings</div>
	<label for="formatting_mode">number formatting: </label>
	<select name="formatting_mode" id="formatting_mode" class="button" style="color:#ffffff;">
		<option value="0">long (million, billion, etc.)</option>
		<option value="1">short (M, B, T, Qa, Qi, etc.)</option>
		<option value="2">none (1.234e+99 etc.)</option>
	</select>
</div>
<h1 id="dollars" style="padding:4px;border:1px solid #00ff00;position:sticky;position:-webkit-sticky;top:4px;margin:0px 16px 16px 0px;width:33%;background-color:rgba(0,0,0,0.65);text-shadow:2px 2px black;color:#00ff00;">$0.00</h1>
<!--<h1 id="moon_credits" style="padding:4px;border:1px solid #0054ff;position:sticky;position:-webkit-sticky;top:64px;margin:0px 16px 16px 0px;width:33%;background-color:rgba(0,0,0,0.65);text-shadow:2px 2px black;color:#0054ff;">0.00</h1>-->
<div id="buildings"><!--
<div id="lemonade_stand" class="building">
	<h2 class="title">Lemonade Stand </h2>
	<div class="noselect" style="color:#ffffff;font-size:1.25em;display:inline;" id="lemonade_stand_amount">&mdash; 1</div><br>
	<div class="noselect" style="color:#ffffff;font-size:1em;display:inline;" id="lemonade_stand_tier">(no tier) &ndash; 9 more to next tier</div><br>
	<details id="lemonade_stand_tier_effects" hidden><summary>tier effects</summary><p id="lemonade_stand_tier_desc">(no effects)</p></details><br>
	<svg width="328" height="36" id="lemonade_stand_progress">
	  <rect width="216" height="36" style="fill:rgb(0,40,0);stroke-width:1;stroke:rgb(0,40,0)" />
	  <rect width="0" height="36" style="fill:rgb(0,150,0);stroke-width:0;stroke:rgb(0,40,0)" />
	  <text x="108" y="24" fill="#cccccc" style="font-size:22px;" class="svgtext noselect">
		something went wrong
	  </text>
	  <text x="224" y="24" fill="white" class="noselect" style="font-size:18px;text-anchor:start;text-align:start;font-family:initial;">
		00:00:00.000
	  </text>
	</svg><br>
	<button class="button noselect button-disabled" id="lemonade_stand_buy_1" onclick="lemonade_stand.buy(1)" disabled>buy 1x</button><div class="price-cantafford noselect" id="lemonade_stand_price_1"> ($10.00)</div><br>
	<button class="button noselect button-disabled" id="lemonade_stand_buy_10" onclick="lemonade_stand.buy(10)" disabled>buy 10x</button><div class="price-cantafford noselect" id="lemonade_stand_price_10"> ($10,000.00)</div><br>
	<button class="button noselect button-disabled" id="lemonade_stand_buy_100" onclick="lemonade_stand.buy(100)" disabled>buy 100x</button><div class="price-cantafford noselect" id="lemonade_stand_price_100"> ($1,000,000.00)</div><br>
</div>
<div id="newspaper_delivery" class="building">
	<h2 class="title">Newspaper Delivery </h2>
	<div class="noselect" style="color:#ffffff;font-size:1.25em;display:inline;" id="newspaper_delivery_amount">&mdash; 0</div><br>
	<div class="noselect" style="color:#ffffff;font-size:1em;display:inline;" id="newspaper_delivery_tier">(no tier) &ndash; 10 more to next tier</div><br>
	<details id="newspaper_delivery_tier_effects" hidden><summary>tier effects</summary><p id="newspaper_delivery_tier_desc">(no effects)</p></details><br>
	<svg width="328" height="36" id="newspaper_delivery_progress">
	  <rect width="216" height="36" style="fill:rgb(0,40,0);stroke-width:1;stroke:rgb(0,40,0)" />
	  <rect width="0" height="36" style="fill:rgb(0,150,0);stroke-width:0;stroke:rgb(0,40,0)" />
	  <text x="108" y="24" fill="#cccccc" style="font-size:22px;" class="svgtext noselect">
		something went wrong
	  </text>
	  <text x="224" y="24" fill="white" class="noselect" style="font-size:18px;text-anchor:start;text-align:start;font-family:initial;">
		00:00:00.000
	  </text>
	</svg><br>
	<button class="button noselect button-disabled" id="newspaper_delivery_buy_1" onclick="newspaper_delivery.buy(1)" disabled>buy 1x</button><div class="price-cantafford noselect" id="newspaper_delivery_price_1"> ($10.00)</div><br>
	<button class="button noselect button-disabled" id="newspaper_delivery_buy_10" onclick="newspaper_delivery.buy(10)" disabled>buy 10x</button><div class="price-cantafford noselect" id="newspaper_delivery_price_10"> ($10,000.00)</div><br>
	<button class="button noselect button-disabled" id="newspaper_delivery_buy_100" onclick="newspaper_delivery.buy(100)" disabled>buy 100x</button><div class="price-cantafford noselect" id="newspaper_delivery_price_100"> ($1,000,000.00)</div><br>
</div>-->
</div>
<div id="upgrades" class="upgrades">
	<h2 id="upgrades_title" class="title">Upgrades</h2><br><br>
	<table style="width:100%;">
		<tr>
			<th style="width:25%"></th>
			<th style="width:25%"></th>
			<th style="width:25%"></th>
			<th style="width:25%"></th>
		</tr>
		<tr>
		</tr>
		<tr>
		</tr>
	</table>
</div>
<script>
class currency {
	constructor(name, symbol) {
		this.name = name;
		this.symbol = symbol;
		// maybe desc later?
		
		this.amount = 0n;
		this.total = 0n;
		this.all_time = 0n;
	}
	earn(earning) {
		this.amount += earning;
		this.total += earning;
		this.all_time += earning;
	}
	spend(expenditure) {
		this.amount -= expenditure;
	}
	get_amount() {return this.amount;}
	get_total() {return this.total;}
	get_all_time() {return this.all_time;}
}
class world {
	constructor(name, currency, buildings, upgrades, tiers) {
		this.name = name;
		this.currency = currency;
		this.buildings = buildings;
		this.upgrades = upgrades;
	}
}
let dollars = new currency("dollar", "$");
let moon_credits = new currency("moon credit", String.fromCharCode(9789));
let mars_dollars = new currency("mars dollar", String.fromCharCode(8380));
let termins = new currency("termin", String.fromCharCode(10810));
//let dollars = 0n;
let money_display_threshold = 100000000n;

let irregulars_long = ["","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion"];
let prefixes_long = ["","un","duo","tre","quattuor","quin","sex","septen","octo","novem"];
let infixes_long = ["","de","vi","tri","quadra","quinqua","sexa","septua","octa","nona"];
let suffixes_long = ["c","gint","cent","ducent","trecent","quadringent","quingent","sescent","septingent","octingent","nongent","amongent"];

let irregulars_short = ["","M","B","T","Qa","Qi","Sx","Sp","Oc","No"];
let prefixes_short = ["","Un","Do","Tr","Qa","Qi","Sx","Sp","Oc","No"];
let infixes_short = ["","D","V","T","Qa","Qi","Sx","Sp","O","N"];
let suffixes_short = ["c","g","Cn","Dcn","Tcn","Qan","Qin","Scn","Spn","Ocn","Non","Amg"];

function get_element(e) {
	return document.getElementById(e);
}

function formatting(irregulars, prefixes, infixes, suffixes, illion="illion", spacing=" ") {
	return function (n, prefix="$") {
		if (n < money_display_threshold) {
			let string = "";
			let chars = (n + "").split("").reverse();
			for (let i = 0; i < chars.length; i++)
			{  // we have to move over 2 places for the cents
				if (i%3 == 0+2 && i > 0+2) string = "," + string;
				if (i == 2) string = "." + string;
				string = chars[i] + string;
			}
			if (string.length <3) string = ("0.0").substr(0,4-string.length) + string;
			string = prefix + string;
			return string;
		}
		
		let str_n = (n+"");
		let magnitude = ((n+"").length-3)-2; // minus two for the cents
		let illionth = Math.floor((magnitude-3+2)/3);
		
		str_n = str_n.substr(0,4 + (magnitude+2)%3);
		let chars = str_n.split("").reverse();
		let string = "";
		for (let i = 0; i < chars.length; i++) {
			if (i == 3 && string.length > 0) string = "." + string;
			if (chars[i] != '0' || string.length > 0 || i >= 3) string = chars[i] + string;
		}
		let ending = illion;
		if (illionth <= 9) string = string + spacing + irregulars[illionth];
		if (illionth >= 10 && Math.floor(illionth/100)+1 < suffixes.length) {
			digits = (illionth + "").split("").reverse();
			if (illionth >= 10 && illionth < 20) ending = suffixes[0] + ending;
			if (illionth >= 20 && illionth < 100) ending = suffixes[1] + ending;
			if (illionth >= 100) ending = suffixes[Math.floor(illionth/100)+1] + ending;
			string = string + spacing + prefixes[digits[0]] + infixes[digits[1]] + ending;//("s".repeat(illionth%100 == 23 ? 1 : 0)) + infixes[digits[1]] + ending;
			// there's a lot going on here, but that "s".repeat part is so that "trevigintillion" (which is the 23rd) is written with an 's', as "tresvigintillion". this will also occur on any illion number whose base 10 representation ends with "23".
		}
		if (Math.floor(illionth/100)+1 >= suffixes.length) {
			let ord_indicators = ["th","st","nd","rd","th","th","th","th","th","th"];
			let ord_indicator = ord_indicators[Number(((illionth+'').split("").reverse())[0])];
			return prefix + string + " " + illionth + ord_indicator + "&ndash;" + ending;
		}
		return prefix + string;
	}
}
function raw_formatting(n, prefix="$") {
	if (n < money_display_threshold) return formattings[0](n, prefix);
	let chars = (n+'').substr(0,4).split("").reverse();
	let string = "";
	for (let i = 0; i < 4; i++) {
		if (i == 3 && string.length > 0) string = "." + string;
		if (chars[i] != '0' || string.length > 0 || i >= 3) string = chars[i] + string;
	}
	let mag = (n+'').length-3; // minus two (or something?) for cents
	return prefix + string + "e+" + mag;
}
formattings = [
	formatting(irregulars_long, prefixes_long, infixes_long, suffixes_long),
	formatting(irregulars_short, prefixes_short, infixes_short, suffixes_short, "", ""),
	raw_formatting
];
let formatting_mode = 0;
let money =(n, prefix="$")=> {return formattings[formatting_mode](n,prefix);}

let temporal_suffixes = ["s","ms","&mu;s","ns","ps","fs","as","zs","ys"];
function as_time(t, do_ms=false) {
	if (t >= 0.001) {
		let ms = Math.round((t*1000)%1000);
		let s = Math.floor(t);
		let m = Math.floor(s/60);
		let h = Math.floor(m/60);
		s %= 60;
		m %= 60;
		try {
			return ("0".repeat(Math.max(0,2-(h+'').length))) + h + ":" + ("0".repeat(2-(m+'').length)) + m + ":" + ("0".repeat(2-(s+'').length)) + s + ("." + ("0".repeat(Math.max(0,3-(ms+'').length))) + ms).repeat(do_ms ? 1 : 0);
		} catch {
			return "t was nan";
		}
	}
	//let t_as_string = t.toExponential();
	//let location_of_e = t_as_string.indexOf("e");
	//let inv_magnitude = Number(t_as_string.substr(location_of_e+2));
	let printed_time = t;
	let suffix_index = 0;
	while (printed_time < 1) {
		printed_time *= 1000;
		suffix_index++;
	}
	if (suffix_index < temporal_suffixes.length) {
		return Math.round(printed_time) + temporal_suffixes[suffix_index];
	} else {
		let exponent = suffix_index * 3;
		while (printed_time >= 10) {
			printed_time /= 10;
			exponent--;
		}
		suffix = "e-"+exponent+"s";
		printed_time = (printed_time+'').substr(0,4);
		return printed_time + suffix;
	}
}

let buildings = [];
let upgrades = [];
let buy_amounts = ["1","10","100"]; // bluh
// bleghhhhh
class building {
	constructor(name, display_name, base_speed, base_profit, base_price, base_price_multiplier=1.15, currency="dollars") {
		this.id = buildings.length;
		this.display_name = display_name;
		this.name = name;
		this.time = 0;
		this.base_speed = base_speed;
		this.base_profit = base_profit;
		this.base_price = base_price;
		this.base_price_multiplier = base_price_multiplier;
		this.currency = currency;
		this.amount = 0;
		this.profit_multiplier = 1n;
		this.speed_multiplier = 1;
		this.tiers = [];
		this.freebies = 0;
		// following variables are redundancies for speeding things up
		this.calculated_price = 0n;
		this.amount_at_calculated_price = -1;
		this.recalculate_price = false;
		
		buildings.push(this); // push this building object to the list of building objects to be ticked by the game loop.
		// the code below will create a <div> element for the actual interface of the building and at it to the main building element.
		
		let buildings_element = document.getElementById("buildings");
		let building_element = document.createElement("div");
		building_element.setAttribute("id", name);
		building_element.setAttribute("class", "building");
		
		let building_title = document.createElement("h2");
		building_title.setAttribute("class", "title");
		let building_title_innerHTML = document.createTextNode(display_name+" ");
		building_title.appendChild(building_title_innerHTML);
		
		// hide all the details before the first buy
		let building_interface = document.createElement("div");
		building_interface.setAttribute("id", name+"_interface");
		building_interface.setAttribute("style", "display:none;");
		
		let building_amount = document.createElement("div");
		building_amount.setAttribute("class", "noselect");
		building_amount.setAttribute("style", "color:#ffffff;font-size:1.25em;display:inline;");
		building_amount.setAttribute("id", name+"_amount");
		
		/*<div class="noselect" style="color:#ffffff;font-size:1.25em;display:inline;" id="lemonade_stand_amount">&mdash; 1</div><br>*/
		
		let building_tier = document.createElement("div");
		building_tier.setAttribute("class", "noselect");
		building_tier.setAttribute("style", "color:#ffffff;font-size:1em;display:inline;");
		building_tier.setAttribute("id", name+"_tier");
		
		/*<div class="noselect" style="color:#ffffff;font-size:1em;display:inline;" id="lemonade_stand_tier">(no tier) &ndash; 9 more to next tier</div><br>*/
		
		let tier_effects = document.createElement("details");
		tier_effects.setAttribute("id", name+"_tier_effects");
		tier_effects.setAttribute("hidden", true);
		
		let tier_effects_summary = document.createElement("summary");
		tier_effects_summary.setAttribute("class", "noselect");
		let tier_effects_summary_text = document.createTextNode("tier effects"); // long winded
		tier_effects_summary.appendChild(tier_effects_summary_text);
		
		let tier_effects_desc = document.createElement("p");
		tier_effects_desc.setAttribute("id", name+"_tier_desc");
		
		tier_effects.appendChild(tier_effects_summary);
		tier_effects.appendChild(tier_effects_desc);
		
		/*<details id="lemonade_stand_tier_effects" hidden><summary>tier effects</summary><p id="lemonade_stand_tier_desc">(no effects)</p></details><br>*/
		
		//let building_progress_svg = document.createElement("svg");
		//building_progress_svg.setAttribute("width", "328");
		//building_progress_svg.setAttribute("height", "36");
		//building_progress_svg.setAttribute("id", name+"_progress");
		/*building_progress_svg.innerHTML = '<rect width="216" height="36" style="fill:rgb(0,40,0);stroke-width:1;stroke:rgb(0,40,0)" />';
		building_progress_svg.innerHTML += '<rect width="0" height="36" style="fill:rgb(0,150,0);stroke-width:0;stroke:rgb(0,40,0)" />';
		building_progress_svg.innerHTML += '<text x="108" y="24" fill="#cccccc" style="font-size:22px;" class="svgtext noselect">something went wrong</text><text x="224" y="24" fill="white" class="noselect" style="font-size:18px;text-anchor:start;text-align:start;font-family:initial;">00:00:00.000</text>';*/
		
		
		//building_progress_svg.innerHTML += '<rect width="0" height="36" style="fill:rgb(0,150,0);stroke-width:0;stroke:rgb(0,40,0)" />';
		/*
		let bg_rect = document.createElement("rect");
		bg_rect.setAttribute("width", "216");
		bg_rect.setAttribute("height", "36");
		bg_rect.setAttribute("style", "fill:rgb(0,40,0);stroke-width:1;stroke:rgb(0,40,0)");
		bg_rect.ownerSVGElement = building_progress_svg;
		let pg_rect = document.createElement("rect");
		pg_rect.setAttribute("width", "0");
		pg_rect.setAttribute("height", "36");
		pg_rect.setAttribute("style", "fill:rgb(0,150,0);stroke-width:0;stroke:rgb(0,40,0)");
		pg_rect.ownerSVGElement = building_progress_svg;
		let profit_text = document.createElement("text");
		profit_text.setAttribute("x", "108");
		profit_text.setAttribute("y", "24");
		profit_text.setAttribute("fill", "#cccccc");
		profit_text.setAttribute("style", "font-size:22px;");
		profit_text.setAttribute("class", "svgtext noselect");
		profit_text.ownerSVGElement = building_progress_svg;
		let profit_text_innerHTML = document.createTextNode("something went wrong");
		profit_text.appendChild(profit_text_innerHTML);
		let time_text = document.createElement("text");
		time_text.setAttribute("x", "224");
		time_text.setAttribute("y", "24");
		time_text.setAttribute("fill", "white");
		time_text.setAttribute("class", "noselect");
		time_text.setAttribute("style", "font-size:18px;text-anchor:start;text-align:start;font-family:initial;");
		time_text.ownerSVGElement = building_progress_svg;
		building_progress_svg.appendChild(bg_rect);
		building_progress_svg.appendChild(pg_rect);
		building_progress_svg.appendChild(profit_text);
		building_progress_svg.appendChild(time_text);*/
		/*
		<svg width="328" height="36" id="lemonade_stand_progress">
			<rect width="216" height="36" style="fill:rgb(0,40,0);stroke-width:1;stroke:rgb(0,40,0)" />
			<rect width="0" height="36" style="fill:rgb(0,150,0);stroke-width:0;stroke:rgb(0,40,0)" />
			<text x="108" y="24" fill="#cccccc" style="font-size:22px;" class="svgtext noselect">
				something went wrong
			</text>
			<text x="224" y="24" fill="white" class="noselect" style="font-size:18px;text-anchor:start;text-align:start;font-family:initial;">
				00:00:00.000
			</text>
		</svg><br>*/
		
		building_element.appendChild(building_title);
		building_interface.appendChild(building_amount);
		building_interface.appendChild(document.createElement("br"));
		building_interface.appendChild(building_tier);
		building_interface.appendChild(document.createElement("br"));
		building_interface.appendChild(tier_effects);
		building_interface.appendChild(document.createElement("br"));
		building_interface.innerHTML += '<svg width="328" height="36" id="'+name+'_progress"><rect width="216" height="36" style="fill:rgb(0,40,0);stroke-width:1;stroke:rgb(0,40,0)"></rect><rect width="0" height="36" style="fill:rgb(0,150,0);stroke-width:0;stroke:rgb(0,40,0)"></rect><text x="108" y="24" fill="#cccccc" style="font-size:22px;" class="svgtext noselect">something went wrong</text><text x="224" y="24" fill="white" class="noselect" style="font-size:18px;text-anchor:start;text-align:start;font-family:initial;">00:00:00.000</text></svg>';
		//building_element.appendChild(building_progress_svg);
		building_interface.appendChild(document.createElement("br"));
		
		for (let i = 0; i < buy_amounts.length; i++) { // this is a bit weird but it makes the code less runny
			let buy_button = document.createElement("button");
			buy_button.setAttribute("class", "button noselect button-disabled");
			buy_button.setAttribute("id", name+"_buy_"+buy_amounts[i]);
			buy_button.setAttribute("onclick", name+".buy("+buy_amounts[i]+")");
			buy_button.setAttribute("disabled", true);
			let buy_button_innerHTML = document.createTextNode("buy "+buy_amounts[i]+"x");
			buy_button.appendChild(buy_button_innerHTML);
			
			let buy_button_price = document.createElement("div");
			buy_button_price.setAttribute("class", "price-cantafford noselect");
			buy_button_price.setAttribute("id", name+"_price_"+buy_amounts[i]);
			
			building_interface.appendChild(buy_button);
			building_interface.appendChild(buy_button_price);
			building_interface.appendChild(document.createElement("br"));
		}
		
		/*<button class="button noselect button-disabled" id="lemonade_stand_buy" onclick="lemonade_stand.buy()" disabled>buy 1x</button>
		<div class="price-cantafford noselect" id="lemonade_stand_price"> ($10.00)</div><br>
		<button class="button noselect button-disabled" id="lemonade_stand_buy_10" onclick="lemonade_stand.buy(10)" disabled>buy 10x</button>
		<div class="price-cantafford noselect" id="lemonade_stand_price_10"> ($10,000.00)</div><br>
		<button class="button noselect button-disabled" id="lemonade_stand_buy_100" onclick="lemonade_stand.buy(100)" disabled>buy 100x</button>
		<div class="price-cantafford noselect" id="lemonade_stand_price_100"> ($1,000,000.00)</div><br>*/
		
		building_element.appendChild(building_interface);
		
		let invest_button_br = document.createElement("br");
		invest_button_br.setAttribute("id", name+"_invest_button_br");
		building_element.appendChild(invest_button_br);
		
		// special button to grab attention to a new unlockable building
		let invest_button = document.createElement("button");
		invest_button.setAttribute("id", name+"_invest_button");
		invest_button.setAttribute("class", "button noselect button-disabled");
		invest_button.setAttribute("onclick", name+".buy()");
		invest_button.setAttribute("disabled", true);
		invest_button.setAttribute("style", "font-size:22px;margin:12px;");
		let invest_button_text = document.createTextNode("Buy for ");
		let invest_button_price = document.createElement("div");
		invest_button_price.setAttribute("style", "display:inline;font-size:22px;");
		invest_button_price.setAttribute("class", "price-cantafford noselect");
		invest_button_price.setAttribute("id", name+"_invest_button_price");
		invest_button.appendChild(invest_button_text);
		invest_button.appendChild(invest_button_price);
		building_element.appendChild(invest_button);
		
		buildings_element.appendChild(building_element);
		
		// that's soil folks
	}
	tick() {
		if (this.get_amount() > 0) this.time += (cur_loop_time - past_loop_time)/1000;
		if (this.time > this.get_time()) { // pretty simple. calculating loopovers here results in out-of-tab production, as well as accurate calculation of profits if speeds begin exceeding the refresh rate of the main game loop.
			let loopovers = Math.floor(this.time / this.get_time());
			eval(this.currency+".earn(this.get_profit() * BigInt(loopovers));");
			this.time %= this.get_time();
		}
	}
	get_price(n=1) {
		if (n == 0) return 0n;
		if (n == 1) { // do this bigint arithmetic only when we need to, otherwise this becomes a laggy mess
			if (this.amount_at_calculated_price != this.amount || this.recalculate_price) {
				this.recalculate_price = false;
				let multiplier = 100n;
				for (let i = 0; i < this.amount; i++) {
					multiplier *= BigInt(Math.round(this.base_price_multiplier * 100));
					multiplier /= 100n;
				}
				this.calculated_price = (this.base_price * multiplier)/100n;
			}
			return this.calculated_price;
		} // unfortunately, this means we cannot get the price for a quantity of something if the price of that quantity exceeds 1.7*10^308 times its current value
		let multiplier = this.base_price_multiplier**(n-1);
		if (multiplier*100 == Infinity) return 0n; // hehe oops guess we hit infinity
		let bigint_mult = BigInt(Math.round(multiplier*100));
		let price_for_n = ((this.calculated_price)*bigint_mult)/100n;
		this.amount_at_calculated_price = this.amount; // we do not take freebies into account, because they are free. thus, we get the amount count directly, instead of get_amount, which would include free buildings.
		return price_for_n+this.get_price(n-1);
	}
	get_profit() {
		return this.base_profit * BigInt(this.get_amount()) * BigInt(this.profit_multiplier);
	}
	get_time() {
		return this.base_speed / this.speed_multiplier; // ugh this is so nonsensical
		// base speed (used to be base time, which used to be max time) is the time it takes for this building to complete a profit cycle
		// the "speed" "multiplier" is a number which is multiplicatively modified to be larger
		// the bigger the "multiplier" is, the more division will be applied to the time it takes for the building to finish
		// this will, in turn, make the building faster
		// rrrrr
	}
	get_amount() {
		return this.amount + this.freebies;
	}
	buy(n=1) {
		if (eval(this.currency+".get_amount() >= this.get_price(n);")) {
			eval(this.currency+".spend(this.get_price(n));");
			this.amount += n;
		}
	}
}
class upgrade {
	constructor(name, desc, price, action, currency="dollars") {
		this.id = upgrades.length;
		this.name = name;
		this.desc = desc;
		this.price = price;
		this.action = action;
		this.currency = currency;
		this.purchased = false;
		upgrades.push(this);
	}
	buy() {
		if (eval(this.currency+".get_amount() >= this.price;")) {
			eval(this.currency+".spend(this.price);");
			this.purchased = true;
			this.remove_button();
			refresh_upgrade_buttons();
		}
	}
	add_button(place) {
		let row = document.getElementById("upgrades").children[3].children[0].children[1+Math.floor(place/4)];
		let entry = document.createElement("th");
		entry.setAttribute("id", "upgrade"+this.id+"entry");
		let button = document.createElement("button");
		button.setAttribute("class", "button noselect button-disabled");
		button.setAttribute("id", "upgrade"+this.id);
		button.setAttribute("style", "width:100%;");
		button.setAttribute("disabled", true);
		button.setAttribute("onclick", "upgrades["+this.id+"].buy()");
		
		let name = document.createElement("div");
		name.setAttribute("id", "upgrade"+this.id+"name");
		name.setAttribute("style", "font-family:Arial, Helvetica, sans-serif;");//font-weight:bold;");
		let name_text = document.createTextNode(upgrades[this.id].name);
		name.appendChild(name_text);
		
		let desc = document.createElement("div");
		desc.setAttribute("id", "upgrade"+this.id+"desc");
		desc.setAttribute("style", "font-style:italic;font-family:initial;");
		let desc_text = document.createTextNode(upgrades[this.id].desc);
		desc.appendChild(desc_text);
		
		let price = document.createElement("div");
		price.setAttribute("id", "upgrade"+this.id+"price");
		price.setAttribute("class", "price-cantafford noselect");
		let price_text = document.createTextNode(formattings[formatting_mode](upgrades[this.id].price));
		price.appendChild(price_text);
		
		button.appendChild(name);
		button.appendChild(desc);
		button.appendChild(price);
		entry.appendChild(button);
		row.appendChild(entry);
	}
	remove_button() {
		try {
			get_element("upgrade"+this.id+"entry").remove();
		} catch {
			// better luck next time
		}
	}
}
class tier {
	constructor(name, desc, amount, action, building_name) {
		this.name = name;
		this.desc = desc;
		this.amount = amount;
		this.action = action;
		this.building_name = building_name;
		eval(building_name + ".tiers.push(this);");
	}
	reached() {
		return eval(this.building_name+".get_amount()") >= this.amount;
	}
}
/* * * Buildings * * */
lemonade_stand = new building("lemonade_stand", "Lemonade Stand", 2, 50n, 2n * 100n, 1.15, "dollars");
lemonade_stand.freebies = 1;
newspaper_delivery = new building("newspaper_delivery", "Newspaper Delivery", 4, 10n * 100n, 25n * 100n, 1.17, "dollars");
car_wash = new building("car_wash", "Car Wash", 9.5, 210n * 100n, 800n * 100n, 1.16, "dollars");
pizza_delivery = new building("pizza_delivery", "Pizza Delivery", 12, 650n * 100n, 7500n * 100n, 1.16, "dollars");
//donut shop
//shrimp boat
//hockey team
//movie studio
//bank
//oil company
//space rollercoaster
//antimatter shipment

//amogus = new building("amogus", "Amogus (2019)", 0.5, 10000n * 100n, 1n * 100n, 1.13, "dollars");
//amogus_tier0 = new tier("sus crewmate", "amogus speed x999", 100, action=()=>{amogus.speed_multiplier*=999;}, "amogus");
//amogus_tier1 = new tier("sus crewmate x2", "amogus speed x999", 200, action=()=>{amogus.speed_multiplier*=999;}, "amogus");

/* * * Upgrades * * */
lemonade_stand_up0 = new upgrade("Paper Umbrellas", "Lemonade Stand profit x3", 50000n, action=()=>{lemonade_stand.profit_multiplier*=3n;}, "dollars");
newspaper_delivery_up0 = new upgrade("Sturdier Bikes", "Newspaper Delivery profit x3", 300000n, action=()=>{newspaper_delivery.profit_multiplier*=3n;}, "dollars");
car_wash_up0 = new upgrade("Bubblier Soaps", "Car Wash profit x3", 1500000n, action=()=>{car_wash.profit_multiplier*=3n;}, "dollars");
pizza_delivery_up0 = new upgrade("Garlic Sauce", "Pizza Delivery profit x3", 4000000n, action=()=>{pizza_delivery.profit_multiplier*=3n;}, "dollars");

everything_up0 = new upgrade("Marketeer", "Everything profit x3", 9000000n, action=()=>{for (let i = 0; i < buildings.length; i++) {if (buildings[i].currency == "dollars") {buildings[i].profit_multiplier*=3n;}}}, "dollars");

lemonade_stand_up1 = new upgrade("Flashy Banners", "Lemonade Stand profit x3", 15000000n, action=()=>{lemonade_stand.profit_multiplier*=3n;}, "dollars");
newspaper_delivery_up1 = new upgrade("Crossword Puzzles", "Newspaper Delivery profit x3", 90000000n, action=()=>{newspaper_delivery.profit_multiplier*=3n;}, "dollars");
car_wash_up1 = new upgrade("Absorbier Sponges", "Car Wash profit x3", 270000000n, action=()=>{car_wash.profit_multiplier*=3n;}, "dollars");
pizza_delivery_up1 = new upgrade("Fresh Toppings", "Pizza Delivery profit x3", 490000000n, action=()=>{pizza_delivery.profit_multiplier*=3n;}, "dollars");

everything_up1 = new upgrade("Clever Strategies", "Everything profit x3", 1000000000n, action=()=>{for (let i = 0; i < buildings.length; i++) {if (buildings[i].currency == "dollars") {buildings[i].profit_multiplier*=3n;}}}, "dollars");

/* * * Tiers * * */
lemonade_stand_tier0 = new tier("Lemonade Novice", "Lemonade Stand speed x2", 25, action=()=>{lemonade_stand.speed_multiplier*=2;}, "lemonade_stand");
lemonade_stand_tier1 = new tier("Lemongineer", "Lemonade Stand speed x2", 50, action=()=>{lemonade_stand.speed_multiplier*=2;}, "lemonade_stand");
lemonade_stand_tier2 = new tier("Lemon Officianado", "Lemonade Stand profit x2", 100, action=()=>{lemonade_stand.profit_multiplier*=2n;}, "lemonade_stand");
lemonade_stand_tier3 = new tier("Professional Juicer", "Lemonade Stand profit x2", 150, action=()=>{lemonade_stand.speed_multiplier*=2;}, "lemonade_stand");

newspaper_delivery_tier0 = new tier("Extra extra!", "Newspaper Delivery speed x2", 25, action=()=>{newspaper_delivery.speed_multiplier*=2;}, "newspaper_delivery");
newspaper_delivery_tier1 = new tier("Today in Business", "Newspaper Delivery profit x2", 50, action=()=>{newspaper_delivery.profit_multiplier*=2n;}, "newspaper_delivery");
newspaper_delivery_tier2 = new tier("Breaking News", "Newspaper Delivery profit x2", 100, action=()=>{newspaper_delivery.profit_multiplier*=2n;}, "newspaper_delivery");

car_wash_tier0 = new tier("Soap Novice", "Car Wash speed x2", 25, action=()=>{car_wash.speed_multiplier*=2;}, "car_wash");
car_wash_tier1 = new tier("Cleanliness Agent", "Car Wash profit x2", 50, action=()=>{car_wash.profit_multiplier*=2n;}, "car_wash");
car_wash_tier2 = new tier("Avid Soap-Salesman", "Car Wash profit x2", 100, action=()=>{car_wash.profit_multiplier*=2n;}, "car_wash");

pizza_delivery_tier0 = new tier("Pizza Time", "Pizza Delivery speed x2", 25, action=()=>{pizza_delivery.speed_multiplier*=2;}, "pizza_delivery");
pizza_delivery_tier1 = new tier("Pizza Parlor", "Pizza Delivery speed x2", 50, action=()=>{pizza_delivery.speed_multiplier*=2;}, "pizza_delivery");
pizza_delivery_tier2 = new tier("Pizza Pie", "Pizza Delivery speed x2", 100, action=()=>{pizza_delivery.speed_multiplier*=2;}, "pizza_delivery");

function refresh_upgrade_buttons(remove=true) {
	let i = 0;
	let place_to_fill = 0;
	for (let i = 0; i < upgrades.length; i++) {
		if (!upgrades[i].purchased) {
			if (remove) upgrades[i].remove_button();
			upgrades[i].add_button(place_to_fill);
			place_to_fill++;
		}
		if (place_to_fill >= 8) break;
	}
}
refresh_upgrade_buttons(false);

function get_time() {
	let t = new Date();
	return t.getTime();
}
let past_loop_time = get_time();
let cur_loop_time = get_time();
function loop() {
	cur_loop_time = get_time();
	let currently_displayed_upgrades = 0;
	get_element("upgrades_title").attributes.class.value = "title";
	for (let i = 0; i < upgrades.length; i++) {
		if (upgrades[i].purchased) {
			upgrades[i].action();
		} else {
			let can_afford = eval(upgrades[i].currency+".get_amount() >= upgrades[i].price;");
			get_element("upgrade"+upgrades[i].id+"price").setAttribute("class", "price-"+(can_afford ? "can" : "cant")+"afford noselect");
			get_element("upgrade"+upgrades[i].id+"price").innerHTML = formattings[formatting_mode](upgrades[i].price);
			get_element("upgrade"+upgrades[i].id).setAttribute("class", "button noselect button-"+(can_afford ? "enabled" : "disabled"));
			get_element("upgrade"+upgrades[i].id).disabled = !can_afford;
			if (can_afford) get_element("upgrades_title").attributes.class.value = "title important-text";
			currently_displayed_upgrades++;
		}
		if (currently_displayed_upgrades >= 8) break;
	}
	for (let i = 0; i < buildings.length; i++) {
		if (buildings[i].get_amount() > 0) {
			get_element(buildings[i].name+"_interface").setAttribute("style", "display:contents;");
			get_element(buildings[i].name+"_invest_button").setAttribute("style", "display:none;");
			get_element(buildings[i].name+"_invest_button_br").setAttribute("style", "display:none;");
			let full_tier_desc = "";
			for (let ii = 0; ii < buildings[i].tiers.length; ii++) {
				if (buildings[i].tiers[ii].reached()) {
					buildings[i].tiers[ii].action();
					if (ii != 0) full_tier_desc += "<br>";
					full_tier_desc += buildings[i].tiers[ii].name + ": " + buildings[i].tiers[ii].desc;
				}
				else {
					let tier_name = "";
					if (ii > 0) tier_name = buildings[i].tiers[ii-1].name;
					else tier_name = "(no tier)";
					get_element(buildings[i].name+"_tier").innerHTML = "Tier " + ii + ": " + tier_name + " &ndash; " + (buildings[i].tiers[ii].amount - buildings[i].get_amount()) + " more until next tier";
					//full_tier_desc += tier_desc;
					break;
				}
				if (ii == buildings[i].tiers.length - 1) { // we didn't hit that preemptive break, so we must be at the end.
					get_element(buildings[i].name+"_tier").innerHTML = "Tier " + (ii+1).toString() + ": " + buildings[i].tiers[ii].name + " &ndash; tier MAX";
					//full_tier_desc += buildings[i].tiers[ii].desc;
				}
			}
			get_element(buildings[i].name+"_tier_desc").innerHTML = full_tier_desc;
			get_element(buildings[i].name+"_tier_effects").hidden = full_tier_desc == "";
			buildings[i].tick();
			
			let progress_graphic = get_element(buildings[i].name+"_progress");
			progress_graphic.children[1].attributes.width.value = (buildings[i].time / buildings[i].get_time()) * 216;
			let profit_string = formattings[formatting_mode](buildings[i].get_profit());
			progress_graphic.children[2].innerHTML = profit_string;
			progress_graphic.children[2].attributes.style.value = "font-size:"+(22 - (profit_string.length / 4.75))+"px;";//"font-family:initial;font-size:"+(22 - (profit_string.length / 5))+"px;text-align:center;text-anchor:middle;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;-moz-user-select:none;-ms-user-select:none;";
			progress_graphic.children[3].innerHTML = as_time(buildings[i].get_time() - (buildings[i].time * (buildings[i].get_time() > 1)), buildings[i].get_time() <= 1);
			get_element(buildings[i].name+"_amount").innerHTML = "&mdash; " + buildings[i].get_amount();
			
			for (let qty = 0; qty < buy_amounts.length; qty++) {
				let can_purchase = dollars.get_amount() >= buildings[i].get_price(Number(buy_amounts[qty]));
				get_element(buildings[i].name+"_price_"+buy_amounts[qty]).innerHTML = " (" + formattings[formatting_mode](buildings[i].get_price(Number(buy_amounts[qty]))) + ")";
				get_element(buildings[i].name+"_price_"+buy_amounts[qty]).className = can_purchase ? "price-canafford noselect" : "price-cantafford noselect";
				get_element(buildings[i].name+"_buy_"+buy_amounts[qty]).className = can_purchase ? "button noselect button-enabled" : "button noselect button-disabled";
				get_element(buildings[i].name+"_buy_"+buy_amounts[qty]).disabled = !can_purchase;
			}
			
			buildings[i].profit_multiplier = 1n; // this needs to be reset each frame so that upgrade actions do not compound.
			buildings[i].speed_multiplier = 1; // same tbh
			// however, you can't reset them before the profit and time indicators are drawn!
		} else {
			get_element(buildings[i].name+"_interface").setAttribute("style", "display:none;");
			let can_purchase = dollars.get_amount() >= buildings[i].get_price();
			get_element(buildings[i].name+"_invest_button_price").innerHTML = " " + formattings[formatting_mode](buildings[i].get_price());
			get_element(buildings[i].name+"_invest_button_price").className = can_purchase ? "price-canafford noselect" : "price-cantafford noselect";
			get_element(buildings[i].name+"_invest_button").className = can_purchase ? "button noselect button-enabled" : "button noselect button-disabled";
			get_element(buildings[i].name+"_invest_button").disabled = !can_purchase;
			
			if (dollars.get_total() < buildings[i].get_price() / 2n) {
				get_element(buildings[i].name).hidden = true;
			} else {
				get_element(buildings[i].name).hidden = false;
			}
		}
	}
	document.getElementById("dollars").innerHTML = money(dollars.get_amount());
	formatting_mode = Number(get_element("formatting_mode").value);
	past_loop_time = get_time();
	//lemonade_stand.max_time /= 1.01;
	setTimeout(loop, -(cur_loop_time - past_loop_time));
}
loop();
</script>
</body>
</html>